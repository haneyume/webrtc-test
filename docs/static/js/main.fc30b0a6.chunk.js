(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(e,t){},125:function(e,t,n){},126:function(e,t,n){"use strict";n.r(t);var a=n(31),i=n(32),c=n(38),r=n(33),o=n(39),s=n(1),u=n.n(s),l=n(15),d=n(133),p=n(11),f=n.n(p),h=n(40),m=n(131),y=n(132),b=n(63),g=n.n(b),v=null,w=function(){(v=g()("https://vvk954yznl.sse.codesandbox.io/")).on("connect",function(){return console.log("connect")})},C=function(e){v.emit("x",JSON.stringify(e))},j=function(e){v.on("x",function(t){return e(t)})},k={init:function(){w()},send:function(e){C(e)},receive:function(e){j(e)}},x=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(r.a)(t).call(this,e))).state={iceConnectionState:""},n.localVideo=u.a.createRef(),n.remoteVideo=u.a.createRef(),n.pc=null,n}return Object(o.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){k.init(),k.receive(this.receiveSignalData.bind(this)),this.start()}},{key:"render",value:function(){return u.a.createElement(l.a,null,u.a.createElement(l.a,{style:{justifyContent:"center",alignItems:"center",marginBottom:20}},u.a.createElement(m.a,{style:{fontSize:20,fontWeight:"bold"}},"WebRTC"),u.a.createElement(m.a,null,"state: "+this.state.iceConnectionState)),u.a.createElement(l.a,{style:{flexDirection:"row",justifyContent:"center",alignItems:"center"}},u.a.createElement("video",{ref:this.localVideo,width:"500",autoPlay:!0,muted:!0}),u.a.createElement("video",{ref:this.remoteVideo,width:"500",autoPlay:!0})),u.a.createElement(l.a,{style:{flexDirection:"row",justifyContent:"center",alignItems:"center"}},u.a.createElement(y.a,{style:{backgroundColor:"lightgray",margin:20,padding:10,borderRadius:10},onPress:this.call.bind(this)},u.a.createElement(m.a,{style:{color:"white"}},"Call")),u.a.createElement(y.a,{style:{backgroundColor:"lightgray",margin:20,padding:10,borderRadius:10},onPress:this.hangup.bind(this)},u.a.createElement(m.a,{style:{color:"white"}},"hangup"))))}},{key:"start",value:function(){var e=this;this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.setState({iceConnectionState:this.pc.iceConnectionState}),this.pc.onicecandidate=function(e){e.candidate&&k.send({candidate:e.candidate})},this.pc.onaddstream=function(t){e.remoteVideo.current.srcObject=t.stream},this.pc.oniceconnectionstatechange=function(t){e.setState({iceConnectionState:e.pc.iceConnectionState})},navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(t){e.localVideo.current.srcObject=t,e.pc.addStream(t)})}},{key:"call",value:function(){var e=Object(h.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pc.createOffer();case 2:return t=e.sent,e.next=5,this.pc.setLocalDescription(t);case 5:k.send({sdp:this.pc.localDescription});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"hangup",value:function(){var e=Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.pc.close();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"receiveSignalData",value:function(){var e=Object(h.a)(f.a.mark(function e(t){var n,a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=JSON.parse(t)).candidate){e.next=5;break}this.pc.addIceCandidate(new RTCIceCandidate(n.candidate)),e.next=16;break;case 5:if("offer"!==n.sdp.type){e.next=15;break}return this.pc.setRemoteDescription(new RTCSessionDescription(n.sdp)),e.next=9,this.pc.createAnswer();case 9:return a=e.sent,e.next=12,this.pc.setLocalDescription(a);case 12:k.send({sdp:this.pc.localDescription}),e.next=16;break;case 15:"answer"===n.sdp.type&&this.pc.setRemoteDescription(new RTCSessionDescription(n.sdp));case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(s.Component),O=(n(125),function(e){function t(){return Object(a.a)(this,t),Object(c.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return u.a.createElement(l.a,{style:{flex:1,justifyContent:"center",alignItems:"center"}},u.a.createElement(x,null))}}]),t}(s.Component));d.a.registerComponent("app",function(){return O}),d.a.runApplication("app",{rootTag:document.getElementById("root")})},81:function(e,t,n){e.exports=n(126)}},[[81,1,2]]]);
//# sourceMappingURL=main.fc30b0a6.chunk.js.map